<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>紅包計算網站</title>
    <style>
        .title{
            color: red;
            font-size: 30px;
            font-weight: bold;
        }
        .word{
            font-weight: bold;
            font-size: 16px;
        }
        .button{
            font-size: 14px;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
        <br>
        <div><span class="word">帳號</span></div>
        <input id="account">
        <div class="title">計算功能</div>
        <form class="Body">
        <div><input name="money"> <span class="word">元</span> <input name="person"> <span class="word">人</span> <button name="Btn" class="button" type="button" onclick="update()">+</button></div>
        </form>
        <br>
        <button class="button" type="button" onclick="count()">結算</button>
        <div class="Total"></div>
        <br>
        <div class="title">查詢功能</div>
        <div><span class="word">請輸入要查詢的帳號 :</span> <input id="id"> <button name="Search" class="button" type="button" onclick="search()">查詢</span></button></div>
        <div class="answer"></div>
</body>

<script>
    var NameNum = 0;

    function update(){
        var Button = document.getElementsByName('Btn');
        Button[NameNum].style.display = 'none';
        NameNum += 1;
        $('.Body').append('<div><input name="money"> <span class="word">元</span> <input name="person"> <span class="word">人</span> <button name="Btn" class="button" type="button" onclick="update()">+</button></div>');
    }

    function count(){
        var moneylist = document.getElementsByName('money');
        var personlist = document.getElementsByName('person');
        var account = document.getElementById('account').value;
        const map = new Map();

        for(var i = 0; i < moneylist.length; i++){
            var money = moneylist[i].value;
            var person = personlist[i].value;

            map.set(`${i}`, `${money}/${person}`);
        }
        map.set('account', account);
        var data = JSON.stringify(Object.fromEntries(map));

        $.ajax({
            url: "/doCount",
            type: "POST",
            contentType: 'application/json; charset=utf-8',
            data: data,
            success: function (response) {
                response = response.replace('ServiceReturnModel{','');
                response = response.replace('oneHundred=', '百元鈔 : ');
                response = response.replace('fiveHundred=', '五百元鈔 : ');
                response = response.replace('oneThousand=', '千元鈔 : ');
                response = response.replace('}', '')
                var div = document.querySelector('.Total');
                div.innerHTML = "<div>" + response + "</div>";
            }
        });
    }

    function search(){
        var account = document.getElementById('id').value;
        var data = JSON.stringify({'account': document.getElementById('id').value});

        $.ajax({
            url: "/doQuery",
            type: "POST",
            contentType: 'application/json; charset=utf-8',
            data: data,
            success: function (response) {
                response = response.replaceAll('[', '');
                response = response.replaceAll(']', '');
                response = response.replaceAll('CountRecordModel', '');
                response = response.replaceAll('account=' + account + ',', '')
                response = response.replaceAll('thousand=', '千元鈔 : ');
                response = response.replaceAll('fiveHundred=', '五百元鈔 : ');
                response = response.replaceAll('hundred=', ' 百元鈔 : ');
                var div = document.querySelector('.answer');
                div.innerHTML = "<div>" + response + "</div>";
            }
        });
    }
</script>
</html>